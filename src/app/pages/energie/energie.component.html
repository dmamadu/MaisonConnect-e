<!-- Fond dynamique -->
<div class="absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-50 dark:from-black/80 dark:to-black/60 -z-10"></div>

<section class="min-h-screen px-6 py-14 lg:py-20 relative">

  <!-- HERO -->
  <header class="grid lg:grid-cols-2 gap-8 items-center mb-12 lg:mb-16">

    <!-- Texte -->
    <div class="space-y-4">

      <h1 class="text-4xl lg:text-5xl font-extrabold text-gray-900 dark:text-white">
        {{ 'energy.title' | translate }}
      </h1>

      <p class="text-gray-600 dark:text-gray-300 text-lg">
        {{ 'energy.subtitle' | translate }}
      </p>

      <!-- Controls -->
      <div class="mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

        <!-- Filtres -->
        <div class="flex flex-wrap gap-2" role="tablist" aria-label="Filtres de produits">
          <button class="px-4 py-2 rounded-full border transition font-medium text-gray-700 dark:text-gray-200"
                  [class.bg-gray-900]="filter==='all'"
                  [class.text-white]="filter==='all'"
                  (click)="filter='all'">
            {{ 'energy.filtersE.all' | translate }}
          </button>

          <button class="px-4 py-2 rounded-full border transition font-medium text-gray-700 dark:text-gray-200"
                  [class.bg-gray-900]="filter==='panel'"
                  [class.text-white]="filter==='panel'"
                  (click)="filter='panel'">
            {{ 'energy.filtersE.panels' | translate }}
          </button>

          <button class="px-4 py-2 rounded-full border transition font-medium text-gray-700 dark:text-gray-200"
                  [class.bg-gray-900]="filter==='battery'"
                  [class.text-white]="filter==='battery'"
                  (click)="filter='battery'">
            {{ 'energy.filtersE.batteries' | translate }}
          </button>

          <button class="px-4 py-2 rounded-full border transition font-medium text-gray-700 dark:text-gray-200"
                  [class.bg-gray-900]="filter==='inverter'"
                  [class.text-white]="filter==='inverter'"
                  (click)="filter='inverter'">
            {{ 'energy.filtersE.inverters' | translate }}
          </button>

          <button class="px-4 py-2 rounded-full border transition font-medium text-gray-700 dark:text-gray-200"
                  [class.bg-gray-900]="filter==='accessory'"
                  [class.text-white]="filter==='accessory'"
                  (click)="filter='accessory'">
            {{ 'energy.filtersE.accessories' | translate }}
          </button>
        </div>

        <!-- Recherche -->
        <div class="mt-2 sm:mt-0">
          <input
            type="search"
            [(ngModel)]="query"
            placeholder="{{ 'energy.search.placeholder' | translate }}"
           
            class="w-full sm:w-64 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition"
          />
        </div>

      </div>
    </div>

    <!-- Visuel -->
    <div class="flex justify-center lg:justify-end relative">
      <div class="w-80 h-64 lg:w-96 lg:h-72 bg-white/30 dark:bg-black/40 backdrop-blur-xl rounded-3xl shadow-xl flex items-center justify-center overflow-hidden">
        <img
          src="https://images.unsplash.com/photo-1509395176047-4a66953fd231?q=80&w=1800&auto=format&fit=crop&ixlib=rb-4.0.3&s=0c0d1b2a6c3d2aa9a3b5e3b4b2e2c3f4"
          alt="{{ 'energy.image.alt' | translate }}"
          class="w-72 lg:w-80 object-contain transform hover:scale-105 transition"
          loading="lazy"
        />
      </div>
    </div>

  </header>

  <!-- GRID PRODUITS -->
  <section class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">

    <article *ngFor="let p of visibleProducts; let i = index"
             class="bg-white dark:bg-gray-900 rounded-2xl shadow-md dark:shadow-lg overflow-hidden flex flex-col transition transform hover:-translate-y-1 hover:scale-[1.02]"
             [style.animationDelay]="delayForIndex(i)"
             tabindex="0">

      <div class="h-44 bg-gray-50 dark:bg-gray-800 flex items-center justify-center overflow-hidden">
        <img [src]="p.image" [alt]="p.title" class="object-contain w-full h-full" loading="lazy" />
      </div>

      <div class="p-4 flex flex-col flex-1">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">{{ p.title }}</h3>
        <p class="text-gray-600 dark:text-gray-300 flex-1 mt-2">{{ p.description }}</p>

        <!-- Prix -->
        <div class="mt-4">
          <span class="font-bold text-xl text-gray-900 dark:text-white">{{ p.price }}</span>
        </div>

        <!-- Boutons -->
        <div class="mt-4 flex flex-col gap-3">
          <button
            (click)="openDetail(p)"
            class="inline-flex items-center justify-center px-4 py-2 mx-2 min-w-[140px] rounded-full border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800 transition font-medium">
            {{ 'energy.buttonsE.details' | translate }}
          </button>

          <a
            [href]="p.link || '#'"
            target="_blank"
            rel="noopener"
            class="inline-flex items-center justify-center px-4 py-2 min-w-[140px] rounded-full bg-gray-900 text-white dark:bg-white dark:text-black hover:bg-gray-800 dark:hover:bg-gray-200 transition font-medium">
            {{ 'energy.buttonsE.order' | translate }}
          </a>
        </div>
      </div>

    </article>

  </section>

</section>

<!-- MODAL DETAIL PRODUIT -->
<div *ngIf="selectedProduct"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm"
     role="dialog"
     aria-modal="true"
     (click)="closeDetail()">

  <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-5xl w-full mx-4 overflow-auto"
       (click)="$event.stopPropagation()">

    <button
     
      (click)="closeDetail()"
      class="absolute top-4 right-4 text-gray-700 dark:text-gray-200 text-2xl hover:text-gray-900 dark:hover:text-white transition">
      âœ•
    </button>

    <div class="grid lg:grid-cols-2 gap-6 p-6">

      <div class="flex items-center justify-center bg-gray-50 dark:bg-gray-800 rounded-xl overflow-hidden">
        <img [src]="selectedProduct?.image"
             [alt]="selectedProduct?.title"
             class="object-contain w-full h-full"
             loading="lazy" />
      </div>

      <div class="flex flex-col">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ selectedProduct?.title }}</h2>
        <p class="text-gray-600 dark:text-gray-300 mt-2">{{ selectedProduct?.description }}</p>

        <ul *ngIf="selectedProduct?.highlights?.length"
            class="flex flex-wrap gap-2 mt-4">
          <li *ngFor="let h of selectedProduct!.highlights"
              class="px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-900 dark:text-white font-semibold">
            {{ h }}
          </li>
        </ul>

        <table *ngIf="selectedProduct?.specs" class="mt-4 w-full text-left border-collapse">
          <tbody>
            <tr *ngFor="let k of (selectedProduct?.specs | keyvalue)">
              <td class="font-semibold text-gray-900 dark:text-white pr-4 py-1">{{ k.key }}</td>
              <td class="text-gray-600 dark:text-gray-300 py-1">{{ k.value }}</td>
            </tr>
          </tbody>
        </table>

        <div class="mt-6 flex items-center justify-between">
          <span class="text-2xl font-extrabold text-gray-900 dark:text-white">{{ selectedProduct?.price }}</span>

          <a
            [href]="selectedProduct?.link || '#'"
            target="_blank"
            rel="noopener"
            class="px-5 py-2 rounded-full bg-gray-900 text-white hover:bg-gray-800 transition font-semibold">
            {{ 'energy.buttonsE.orderNow' | translate }}
          </a>
        </div>

      </div>

    </div>
  </div>
</div>
